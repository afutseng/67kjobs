// Generated by LiveScript 1.2.0
var x$;
x$ = angular.module('jobs', ['firebase']);
x$.directive('delayBk', function(){
  return {
    restrict: 'A',
    link: function(scope, e, attrs, ctrl){
      var url;
      url = attrs["delayBk"];
      return $('<img/>').attr('src', url).load(function(){
        $(this).remove();
        e.css({
          "backgroundImage": "url(" + url + ")"
        });
        return e.toggleClass('visible');
      });
    }
  };
});
x$.controller('index', function($scope, $timeout, $firebase){
  var update;
  $scope.jobtypes = jobtypes;
  $scope.needfix = false;
  $scope.newjob = {};
  $scope.newjob = {
    title: '測試職稱',
    jobtype: {
      id: 'test',
      name: 'test'
    },
    jobname: {
      id: 'test',
      name: 'test'
    },
    salary1: 67000,
    salary2: 68000,
    location: '台北市',
    company: '市北台',
    email: 'blah@blah.io'
  };
  $scope.jobtype = "";
  $scope.jobs = [];
  $scope.$watch('newjob.jobtype', function(v){
    if ($scope.newjob.jobtype) {
      $scope.jobs = $scope.newjob.jobtype.jobs;
      return console.log($scope.newjob.jobtype.jobs);
    }
  });
  $scope.dbRef = new Firebase('https://joblist.firebaseio.com/jobs');
  $scope.listsrc = $firebase($scope.dbRef);
  $scope.auth = new FirebaseSimpleLogin($scope.dbRef, function(e, u){
    return $scope.user = u;
  });
  $scope.joblist = [];
  console.log($scope.listsrc);
  update = function(){
    var item, results$ = [];
    $scope.joblist = [];
    for (item in $scope.listsrc) {
      if (item.indexOf("$") !== 0) {
        results$.push($scope.joblist.push($scope.listsrc[item]));
      }
    }
    return results$;
  };
  $scope.listsrc.$on('loaded', function(){
    return update();
  });
  $scope.listsrc.$on('change', function(){
    return update();
  });
  /*$scope.joblist = [
    {"company":"foundi.info","email":"hr@foundi.info","jobname":{"id":"0205","name":"裁石工、碎石工"},"jobtype":{"id":"02","jobs":[{"id":"0201","name":"冶金工程師"},{"id":"0202","name":"冶金技術員"},{"id":"0203","name":"採礦工程師"},{"id":"0204","name":"採礦技術員"},{"id":"0205","name":"裁石工、碎石工"},{"id":"0206","name":"裁石工及石雕工"},{"id":"0207","name":"熔爐操作工"},{"id":"0208","name":"爆破工"},{"id":"0209","name":"礦工、採石工"},{"id":"0210","name":"鑽井工"},{"id":"0211","name":"鑿岩工、採石工"}],"name":"採礦冶金職類"},"location":"台北市","salary":67000,"title":"軟體工程師"}
  ]*/
  return $scope.submit = function(){
    var check, t1, t2;
    check = ['jobname', 'salary2', 'salary1', 'company', 'email', 'jobtype', 'location', 'title'];
    t1 = $scope.newjobform.salary1;
    t2 = $scope.newjobform.salary2;
    t1.$setValidity('salary1', $scope.newjob.salary1 < 67000 ? false : true);
    t2.$setValidity('salary2', isNaN($scope.newjob.salary2) || $scope.newjob.salary2 < $scope.newjob.salary1 ? false : true);
    if (check.map(function(it){
      return $scope.newjobform[it].$invalid;
    }).filter(function(it){
      return it;
    }).length) {
      console.log("submit job failed");
      $scope.needfix = true;
      return;
    }
    $scope.listsrc.$add($scope.newjob);
    $scope.newjob = {};
    $scope.needfix = false;
    return console.log("job added");
  };
});